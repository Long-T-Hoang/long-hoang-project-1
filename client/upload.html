<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GunPla Collection</title>

    <link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quattrocento&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="default-styles.css">

<script>
    "use strict"; // because I got rid of client-side babel
  const parseJSON = (xhr, content) => {
      if(xhr.response && xhr.getResponseHeader('Content-Type') === 'application/json'){
        const obj = JSON.parse(xhr.response);
        console.dir(obj);
        
        if(obj.message){
            content.innerHTML += `<p>${obj.message}</p>`;
        }
    }
  };

  const handleResponse = (xhr) => {
    const content = document.querySelector('#content');
    
    switch(xhr.status){
        case 200:
            content.innerHTML = '<b>Success!</b>';
            break;
        case 201:
            content.innerHTML = '<b>Created!</b>';
            break;
        case 204:
            content.innerHTML = '<b>Updated (No Content)!</b>';
            break;
        case 400:
            content.innerHTML = '<b>Bad Request!</b>';
            break;
        default:
            content.innerHTML = '<b>Error code not implemented by client</b>';
    }
    
    parseJSON(xhr,content);
  };

  const sendPost = (e, nameForm) => {
          e.preventDefault();
          
          const nameAction = nameForm.getAttribute("action");
          const nameMethod = nameForm.getAttribute("method");
          
          const nameField = nameForm.querySelector("#nameField");
          const releaseYearField = nameForm.querySelector("#releaseYearField");
          const imageURLField = nameForm.querySelector("#imageURLField");

          const xhr = new XMLHttpRequest();
          xhr.open(nameMethod,nameAction);
          
          xhr.setRequestHeader('Accept','application/json');
          xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
          
          xhr.onload = () => handleResponse(xhr);
          
          const formData = `name=${nameField.value}&releaseYear=${releaseYearField.value}&imageURL=${imageURLField.value}`;
          xhr.send(formData); 
          
          return false; // prevents event bubbling
  };

  const init = () => {
    const nameForm = document.querySelector('#nameForm');
    
    const addKit = (e) => sendPost(e, nameForm);
    
    nameForm.addEventListener('submit', addKit);
  };

  window.onload = init;

</script>
</head>
<body>
    <div id="logo"><h1>GunPla Collection</h1></div>
    <header>
        <a href="/" class="header-link">Main</a>
        <a href="/kits" class="header-link">Kits</a>
        <a href="/upload" class="header-link">Upload</a>
        <a href="/admin" class="header-link">Admin</a>
    </header>
    
    <main>
        <h3>Add GunPla kits</h3>
        <p id="content"></p>
        <form id="nameForm" action="/addKit" method="post">
        <label for="name">Name: </label>
        <input id="nameField" type="text" name="name" />
        <br>
        <label for="releaseYear">Release Year: </label>
        <input id="releaseYearField" type="number" name="releaseYear" min="2000" max="2021" step="1"/>
        <br>
        <label for="imageURL">Link to image:</label>
        <input id="imageURLField" type="text" name="imageURL"/>
        <br>
        <input class="btn" type="submit" value="Add Kit" />
        </form>
    </main>
</body>
</html>